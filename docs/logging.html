<!DOCTYPE html>
<!-- Generated by litjs - https://github.com/apres/lit.js
     Part of the Apres suite - http://apres.github.com/ -->
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <title>mysql-orm: logging.js</title>
  <link href='css/lit-callouts.css' rel='stylesheet' type='text/css'>
  <link href='css/apres.css' rel='stylesheet' type='text/css'>
</head>
<body>
  <div class="lit">
<section>
<div class="lit-comment">
<h1>mysql-orm: logging.js</h1>
</div>
<code class="lit-code">
<span class="string">'use strict'</span>;
<span class="comment">/*
 * MySQL object-relational mapping
 * ===============================
 *
 * (C) 2014 Mark K Cowan &lt;mark@battlesnake.co.uk>
 *
 * https://github.com/battlesnake/node-mysql-orm
 *
 * Released under GNU General Public License, Version 2
 *
 */</span>

<span class="keyword">var</span> cli = require(<span class="string">'cli-color'</span>);

<span class="keyword">var</span> ORM = { prototype: {} };
module.exports = ORM.prototype;
</code>
</section>
<section>
<div class="lit-comment">
<h1>logging</h1>

<p>Colourful logging for mysql-orm</p>

<h2>logLevel: int</h2>

<p>Sets the logging level.<br />+ 0: all messages are ignored including fatal errors.  Do not use this<br />level.<br />+ 1: only fatal errors are logged (and are also thrown).<br />+ 2: warnings are also logged.<br />+ 3: info is also logged.<br />+ 4: for those who use CFLAGS=&quot;-O99&quot; because &quot;-O98&quot; code is just too slow.</p>

<h3>Default</h3>

<p>logLevel = 2</p>
</div>
<code class="lit-code">
ORM.prototype.logLevel = <span class="number">2</span>;

<span class="comment">/* Used in DEBUG mode only, quit whining already */</span>
<span class="function"><span class="keyword">function</span> <span class="title">sleep</span><span class="params">(delay)</span> {</span>
  <span class="comment">/*
   * OMG, a blocking operation in node.js, the developer of this package
   * must be such a useless n00b right?  Just like those damn kernel
   * developers who use `goto`...
   */</span>
  <span class="keyword">var</span> stop = <span class="keyword">new</span> Date().getTime() + delay;
  <span class="keyword">while</span> (<span class="keyword">new</span> Date().getTime() &lt; stop) ;
}
</code>
</section>
<section>
<div class="lit-comment">
<h2>log(level, msg)</h2>

<p>Logging with pretty colours</p>

<p>Logs a message at a custom level</p>

<h3>Example</h3>

<p>log(cli.olive('POTATO'), 'I am a potato');</p>
</div>
<code class="lit-code">
ORM.prototype.log = <span class="function"><span class="keyword">function</span> <span class="params">(level, msg)</span> {</span>
  console.log(cli.green(<span class="string">'mysql-orm'</span>) + <span class="string">' '</span> + level + <span class="string">' '</span> + msg);
  <span class="keyword">if</span> (<span class="keyword">this</span>.debug) sleep(<span class="number">50</span>);
  <span class="keyword">return</span> msg;
}
</code>
</section>
<section>
<div class="lit-comment">
<h2>error(msg)</h2>

<p><strong>Throws an exception</strong></p>

<p>Logs the given message at FAIL level, then throws it as an Error, if<br />logLevel &gt;= 1.  If logLevel !&gt;= 1, stuff will go horribly wrong.</p>

<h3>Example</h3>

<p>error('Access denied to backend database');</p>
</div>
<code class="lit-code">
ORM.prototype.error = <span class="function"><span class="keyword">function</span> <span class="params">(msg)</span> {</span>
  <span class="keyword">if</span> (<span class="keyword">this</span>.logLevel >= <span class="number">1</span>) {
    <span class="keyword">this</span>.log(cli.red.bold(<span class="string">'FAIL'</span>), msg);
    <span class="keyword">throw</span> (msg <span class="keyword">instanceof</span> Error ? msg : <span class="keyword">new</span> Error(msg));
  }
  <span class="keyword">if</span> (<span class="keyword">this</span>.debug) sleep(<span class="number">500</span>);
  <span class="keyword">return</span> msg;
}
</code>
</section>
<section>
<div class="lit-comment">
<h2>warn(msg)</h2>

<p>Logs the given message at WARN level.</p>

<h3>Example</h3>

<p>warn('dropTables specified, dropping all tables');</p>
</div>
<code class="lit-code">
ORM.prototype.warn = <span class="function"><span class="keyword">function</span> <span class="params">(msg)</span> {</span>
  <span class="keyword">if</span> (<span class="keyword">this</span>.logLevel >= <span class="number">2</span>) {
    <span class="keyword">this</span>.log(cli.yellow(<span class="string">'WARN'</span>), msg);
  }
  <span class="keyword">if</span> (<span class="keyword">this</span>.debug) sleep(<span class="number">250</span>);
  <span class="keyword">return</span> msg;
}
</code>
</section>
<section>
<div class="lit-comment">
<h2>info(msg)</h2>

<p>Logs the given message at INFO level.</p>

<h3>Example</h3>

<p>info('Executing query ' + sql);</p>
</div>
<code class="lit-code">
ORM.prototype.info = <span class="function"><span class="keyword">function</span> <span class="params">(msg)</span> {</span>
  <span class="keyword">if</span> (<span class="keyword">this</span>.logLevel >= <span class="number">3</span>) {
    <span class="keyword">this</span>.log(cli.cyan(<span class="string">'INFO'</span>), msg);
  }
  <span class="keyword">return</span> msg;
}
</code>
</section>
<section>
<div class="lit-comment">
<h2>test(msg)</h2>

<p>Logs the given message at TEST level.</p>

<h3>Example</h3>

<p>test('Running test #32');</p>
</div>
<code class="lit-code">
ORM.prototype.test = <span class="function"><span class="keyword">function</span> <span class="params">(msg)</span> {</span>
  <span class="keyword">this</span>.log(cli.magenta(<span class="string">'TEST'</span>), msg);
  <span class="keyword">return</span> msg;
}
</code>
</section>
</div>

</body>
</html>
